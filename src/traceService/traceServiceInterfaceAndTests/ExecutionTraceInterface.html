<html>
    <head>
        <!-- Init Scripts for Execution Trace API !-->
        <script src="traceScripts/esprima.js" type="text/javascript" charset="utf-8"></script>
        <script src="traceScripts/escodegen.browser.js" type="text/javascript" charset="utf-8"></script>
        <script src="traceScripts/esmorph.js" type="text/javascript" charset="utf-8"></script>
        <script src="traceScripts/executiontrace.js" type="text/javascript" charset="utf-8"></script>
        <!-- End Scripts for Execution Trace API !-->
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
        <style>
        #editor { 
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }
        </style>
    </head>
    <body>
        <h3>Simple Range Value Function Testing (getValues(Range))</h3>
        <textarea rows="4" cols="100" id = "mockCode" placeholder="enter test code here">var x = 5;</textarea><br/><br/>
        <table border=1>
            <tr>
                <td></td>
                <td id>Row</td>
                <td id>Col</td>
            </tr>            
            <tr>
                <td>Start</td>
                <td id = "sr"></td>
                <td id = "sc"></td>
            </tr>
            <tr>
                <td>End</td>
                <td id = "er"></td>
                <td id = "ec"></td>
            </tr>
        </table><br/>
        <input id = "inputRange" type = "text" size="30" placeholder="startRow startCol endRow endCol"/><br/><br/>
        <div id = "resultContainer">Results:</div>
        <div id = "currentPos">curPos: </div>
        <div id = "editor"></div>
    <script>
    	// initiating the editor
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.getSession().setMode("ace/mode/javascript");
    	
    	
        $(this).mousemove(function(event){
            $("#currentPos").text("curPos: {X:"+event.pageX+",Y:"+event.pageY+"}");
        });
        $("#inputRange").change(function() {
            //"range":{"start":{"row":18,"column":8},"end":{"row":18,"column":9}}
            var res = $(this).val().split(" ");
            var startRow = {"row":res[0]};
            var startCol = {"col":res[1]};
            var endRow = {"row":res[2]};
            var endCol = {"col":res[3]};
            var concatRange = {"start":{"row":res[0],"col":res[1]},"end":{"row":res[2],"col":res[3]}};
            $("#sr").text(concatRange.start.row);
            $("#sc").text(concatRange.start.col);
            $("#er").text(concatRange.end.row);
            $("#ec").text(concatRange.end.col);
            getValues(concatRange);
        });
        // example of how to use the trace resulting data structure
        function visualizeExecutionTrace(executionTrace){
            var i, entry;
            var stackText= "";
            for (i = 0; i < executionTrace.length; i += 1) {
                entry = executionTrace[i];
                stackText += i + " -- " + JSON.stringify(entry) + "<br> ";
               
            }
        	return stackText;  
        }
        function getValues(Range){
            var stackTrace;
            var valueTable;
            var eventStatus = [];
            window.traceExecution($("#mockCode").val(),
                        function eventListener (event){
                        if(event.status === "Running"){
                            //alert("Running");
                            eventStatus.push(event.description);
                        }else if(event.status === "Finished"){
                            //alert("Finished");
                            stackTrace = window.TRACE.getStackTrace();
                            valueTable = window.TRACE.getExecutionTrace();
                            eventStatus.push(event.description);
                        }else if(event.status === "Error"){
                            //alert("Error");
                            eventStatus.push(event.description);
                        }else if(event.status === "Timeout"){
                            //alert("Timeout");
                            eventStatus.push(event.description);
                        }else if(event.status === "Busy"){
                            //alert("Busy");
                            eventStatus.push(event.description);
                        }
            });
            var entry,ele;
            alert(Object.keys(valueTable[0]));
            for(entry=0;entry<valueTable.length;entry++){
                //var keys = Object.keys(valueTable[entry]);
                if(valueTable[entry].hasOwnProperty("type")){
                    //alert("type");
                }
                if(valueTable[entry].hasOwnProperty("id")){
                    //alert("id");
                }
                if(valueTable[entry].hasOwnProperty("text")){
                    //alert("text");
                }
                if(valueTable[entry].hasOwnProperty("values")){ // problem 1: should be stated as "values"
                    //alert("value");
                    var res;
                    alert(valueTable[entry].values[0].value);
                    $("#resultContainer").text(valueTable[entry].values.value);
                }
            }            
        }

    </script>
    
    </body>
    
</html>