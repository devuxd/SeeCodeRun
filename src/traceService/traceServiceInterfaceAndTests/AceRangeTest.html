<!-- Written by: Execution Trace Feature Team -->
<!-- (@author: Han Tsung Liu-->
<!--  @started: 02-24-16-->
<!--  @last-modified: 02-26-16)-->
<!--  Reviewed by: Dana Turner and Venkat Polumahanti (02-26-16)-->
<!--  Sample Implementation of ExecutionTraceInterface.js
<!--  1) Creating an instance of the ExecutionTraceInterface class- ->
<!--  2) Calling getLineValues(lineNumber) function to retrieve all values for the row in editor-->
<html>
	<head>
	    <!-- Init Scripts for Execution Trace API !-->
	    <script src="traceScripts/esprima.js" type="text/javascript" charset="utf-8"></script>
	    <script src="traceScripts/escodegen.browser.js" type="text/javascript" charset="utf-8"></script>
	    <script src="traceScripts/esmorph.js" type="text/javascript" charset="utf-8"></script>
	    <script src="traceScripts/executiontrace.js" type="text/javascript" charset="utf-8"></script>
	    <!-- End Scripts for Execution Trace API !-->
	    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/ace.js" type="text/javascript" charset="utf-8"></script>
		<script src="ExecutionTraceInterface.js"></script>
	    <style>
	    #editor { 
	        position: absolute;
	        top: 30;
	        right: 250;
	        bottom: 250;
	        left: 5;
	    }
	    </style>
	</head>
	
	<body>
        <h3>Simple Range Value Function Testing (getValues(Range))</h3>
        <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
        <div id = "cursorPos">
            Cursor Position: (x,y) 
        </div>
        <br/>
        <div id = "rowValues">
            Row values on hover-over (without type of statement): 
        </div>
        <br/>
        <div id = "valueOfCurPos">
            Cursor Position: <br/>
        </div>
        <div id = "wholeTrace">
            Trace: <br/>
            Value of a Cursor Position (without type of statement): [] 
        </div>
        <br/>
        <div id = "valueOfCurPosWType">
            Value of a Cursor Position (with type of statement): [] 
        </div>
        <br/><br/>
        <div id = "fullTrace">
            Full Trace: {...}<br/>
        </div>
        <table border=1>
            <tr>
                <td></td>
                <td id>Row</td>
                <td id>Col</td>
            </tr>            
            <tr>
                <td>Start</td>
                <td id = "sr"></td>
                <td id = "sc"></td>
            </tr>
            <tr>
                <td>End</td>
                <td id = "er"></td>
                <td id = "ec"></td>
            </tr>
        </table><br/><br/>
        

        <!-- the position of the code here matches the editor, so no indentation :) -->
<div id="editor">// Assignment Statement
var a = true; // {"AssignmentExpression":"true"}
var b = (true||false); // {"AssignmentExpression":"false"}
var c = (1>5); // {"AssignmentExpression":"false"}
// Conditional Statement
if(a===b){ // not yet implemented (not working correctly)

}
// Loops
var d; // not evalated
for(d=0;d<5;d++){ // not yet implemented (not working correctly)
    
}
var e = 5; // {"AssignmentExpression":"5"}
while(e>0){ // while loop -> {"Loops":5}
    e--; // others -> {"Others":["5","4","3","2","1"]}
}
var f = 0; // {"AssignmentExpression":"0"}
do { // {"Loops":5}
    f++; // others -> {"Others":["0","1","2","3","4"]}
}
while (f < 5);
var g = {"a":"1","b":"2"}; // {"Others":["\1"\""]} and {"Others":["\2"\""]}
for(var gee in g){ // not yet implemented (not working correctly)
    console.log(gee);
}
function x(){ // function declaration
    return 5; // {"ReturnStatement":"5"}
}
x(); //{"FunctionInvocation":"5"}
</div>
    	<script>
    	    // label to display the current result
    		$("#rowValues").css("font-size","20px");
    		$("#cursorPos").css("font-size","20px");
    		$("#valueOfCurPos").css("font-size","20px");
    		$("#wholeTrace").css("font-size", "20px");
    		$("#valueOfCurPosWType").css("font-size","20px");
    		$("#fullTrace").css("font-size","20px");
    		// Initiating the editor
    	    var editor = ace.edit("editor");
    	    editor.setTheme("ace/theme/monokai");
    	    editor.getSession().setMode("ace/mode/javascript");
    	    editor.renderer.setShowGutter(true);
            //  Function is triggered on changing mouse position. mousemove is an ACE method specific for ACE editor  //
            editor.on("mousemove",function(e){
                var acePos = e.getDocumentPosition();
                var valuesOfCurrentLine, valueOfCurrentPosition, valueOfCurrentPositionWType, fullTrace;
                //"range":{"start":{"row":18,"column":8},"end":{"row":18,"column":9}}
                var concatRange = { "start":{"row":acePos.row,
                                    "column":acePos.column},
                                    "end":{"row":acePos.row,
                                    "column":acePos.column}};
                $("#sr").text(concatRange.start.row+1);
                $("#sc").text(concatRange.start.column+1);
                $("#er").text(concatRange.end.row+1);
                $("#ec").text(concatRange.end.column+1);
                // Code typed in the editor is saved into the variable eti. eti stands for Execution Trace Interface //
                var eti = new ExecutionTraceInterface(editor.getSession().getDocument().getValue());
            	/*  if eti is true, get the values of moused over elements into valueOfCurrentLine variable.
            	    Refer ExecutionTraceInterface.html line 38 for more info on linkEstablished 	*/
            	if(eti.linkEstablished){           
            		valuesOfCurrentLine = eti.getLineValues(acePos.row+1);
            		valueOfCurrentPosition = eti.getValues(concatRange);
            		wholeTrace = eti.getWholeTrace();
            		valueOfCurrentPositionWType = eti.getValuesWithType(concatRange);
            		fullTrace = eti.getFullTrace();
            	}
            	//  Updates the div to show the values of mouse hovered elements  
            	$("#rowValues").text("Row Values On Hover-over (without type of statement): "+JSON.stringify(valuesOfCurrentLine));
            	$("#valueOfCurPosWType").text("Value Of Cur Pos (with type of statement): "+JSON.stringify(valueOfCurrentPositionWType));
            	$("#cursorPos").text("Cursor Position: (X:" + (acePos.row+1) + ",Y:" + (acePos.column+1) + ")");
            	$("#valueOfCurPos").text("Value Of Cur Pos (without type of statement): "+JSON.stringify(valueOfCurrentPosition));
            	$("#fullTrace").text("Full Trace: "+fullTrace);
            });
    	</script>
	</body>
</html>